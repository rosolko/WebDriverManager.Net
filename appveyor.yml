version: '{build}'

pull_requests:
  do_not_increment_build_number: true

nuget:
  disable_publish_on_pr: true

branches:
  only:
    - master
    - appveyor

image: Visual Studio 2017
configuration: Release
platform: Any CPU

environment:
  SONAR_LOGIN:
    secure: JNopXLZtkO5PD8yEj2+W1BZnbhq9oegXmTFgvVWQw67z5PtWwd+ngjv5O7xFetCZ

install:
  - cinst opencover.portable
  - cinst msbuild-sonarqube-runner

test: off

before_build:
  - ps: SonarScanner.MSBuild.exe begin /k:"rosolko_WebDriverManager.Net" /d:sonar.organization="rosolko-github" /d:sonar.host.url="https://sonarcloud.io" /d:sonar.login=$env:SONAR_LOGIN /d:sonar.cs.opencover.reportsPaths="opencover.xml"

build_script:
  - ps: dotnet build -c Release
  - ps: OpenCover.Console.exe -output:"opencover.xml" -register:appveyor -target:"%xunit20%\xunit.console.x86.exe" -targetargs:"WebDriverManager.Tests\bin\Release\netcoreapp2.2\WebDriverManager.Tests.dll -noshadow"

after_build:
  - ps: SonarScanner.MSBuild.exe end /d:sonar.login=$env:SONAR_LOGIN
