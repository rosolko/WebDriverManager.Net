version: '{build}'

pull_requests:
  do_not_increment_build_number: true

nuget:
  disable_publish_on_pr: true

branches:
  only:
    - master
    - appveyor

image: Visual Studio 2017

environment:
  SONAR_LOGIN:
    secure: JNopXLZtkO5PD8yEj2+W1BZnbhq9oegXmTFgvVWQw67z5PtWwd+ngjv5O7xFetCZ

install:
  - cinst msbuild-sonarqube-runner

test: off

before_build:
  - ps: SonarScanner.MSBuild.exe begin /k:"rosolko_WebDriverManager.Net" /d:sonar.organization="rosolko-github" /d:sonar.host.url="https://sonarcloud.io" /d:sonar.login=$env:SONAR_LOGIN /d:sonar.language="cs" /d:sonar.exclusions="**/bin/**/*,**/obj/**/*" /d:sonar.coverage.exclusions="WebDriverManager.Tests/**,**/*Tests.cs" /d:sonar.cs.opencover.reportsPaths="%cd%\opencover.xml"

build_script:
  - ps: dotnet restore
  - ps: dotnet build
  - ps: dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat="opencover" /p:CoverletOutput="opencover.xml"

after_build:
  - ps: SonarScanner.MSBuild.exe end /d:sonar.login=$env:SONAR_LOGIN
