version: '{build}'

pull_requests:
  do_not_increment_build_number: true

nuget:
  disable_publish_on_pr: true

branches:
  only:
    - master
    - appveyor

image: Visual Studio 2017
configuration: Release
platform: Any CPU

environment:
  SONAR_LOGIN:
    secure: JNopXLZtkO5PD8yEj2+W1BZnbhq9oegXmTFgvVWQw67z5PtWwd+ngjv5O7xFetCZ

install:
  - cinst msbuild-sonarqube-runner

test: off

before_build:
  - ps: SonarScanner.MSBuild.exe begin /k:"rosolko_WebDriverManager.Net" /d:sonar.organization="rosolko-github" /d:sonar.host.url="https://sonarcloud.io" /d:sonar.login=$env:SONAR_LOGIN /d:sonar.cs.opencover.reportsPaths="coverage.opencover.xml"

build_script:
  - ps: dotnet build -c Release
  - ps: dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat="opencover"

after_build:
  - ps: SonarScanner.MSBuild.exe end /d:sonar.login=$env:SONAR_LOGIN
